import{_ as R,r as l,o as q,e as F,a as n,f as s,J as x,h as C,A as J,l as S,x as $,j as z,i as Q,B as j}from"./index-C2blXwEK.js";import{c as K,d as P,e as _}from"./index-DexdYQBf.js";import{B as G,K as H}from"./Col-BQnMq_kH.js";import{_ as W,R as X}from"./ReloadOutlined-DoUCwVyo.js";import{F as Y,_ as Z}from"./index-CbRG_8c-.js";import{a as ee,I as ae}from"./index-1PGfYYHc.js";const te={class:"blacklist-container"},oe={__name:"BlackList",setup(ne){const y=l(""),v=l([]),f=l(!1),h=l(!1),g=l(!1),k=l(!1),c=l(""),m=l(""),w=l(0),r=l({pageSize:10,total:0,current:1,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showQuickJumper:!0,showTotal:t=>`共 ${t} 条记录`}),A=[{title:"用户",dataIndex:"user",key:"user",width:200},{title:"原因",dataIndex:"reason",key:"reason",ellipsis:!0,width:300},{title:"操作",key:"action",width:150,fixed:"right"}],i=async(t=1,e=r.value.pageSize)=>{var a,o;f.value=!0;try{const d=(t-1)*e,b={search:y.value||void 0,limit:e,offset:d},p=await x.get("/api/blacklist",{params:b});if(p.data&&Array.isArray(p.data.records))v.value=p.data.records,w.value=p.data.total||0,r.value.total=w.value,r.value.current=t,r.value.pageSize=e;else throw new Error("返回数据格式不正确")}catch(d){_.error(`获取黑名单失败: ${((o=(a=d.response)==null?void 0:a.data)==null?void 0:o.message)||d.message||"未知错误"}`),v.value=[],w.value=0,r.value.total=0}finally{f.value=!1}},D=async()=>{h.value=!0;try{await i(1)}finally{h.value=!1}},O=t=>{const e=t.current,a=t.pageSize;i(e,a)},U=()=>{i(r.value.current)},E=()=>{c.value="",m.value="",g.value=!0},L=async()=>{var t,e;if(!c.value||!m.value){_.warning("请填写用户ID和原因");return}k.value=!0;try{const a=await x.post("/api/blacklist",{userId:c.value,reason:m.value});if(a.data.success)_.success(`已添加用户 ${c.value}`),g.value=!1,i(r.value.current);else throw new Error(a.data.message||"添加失败")}catch(a){_.error(`添加黑名单失败: ${((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||a.message||"未知错误"}`)}finally{k.value=!1}},M=async t=>{var e,a;try{const o=await x.delete(`/api/blacklist/${t.id}`);if(o.data.success)_.success(`已移除用户 ${t.user} 从黑名单`),i(r.value.current);else throw new Error(o.data.message||"移除失败")}catch(o){_.error(`移除黑名单失败: ${((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||o.message||"未知错误"}`)}};return q(()=>{i()}),(t,e)=>{const a=ee,o=G,d=K,b=H,p=W,B=ae,I=Z,N=Y,T=P;return C(),F("div",te,[n(d,{style:{"margin-bottom":"16px"}},{default:s(()=>[n(a,{value:y.value,"onUpdate:value":e[0]||(e[0]=u=>y.value=u),placeholder:"搜索黑名单用户",style:{width:"200px"},onSearch:D,loading:h.value},null,8,["value","loading"]),n(o,{onClick:U},{icon:s(()=>[n(J(X))]),_:1}),n(o,{type:"primary",onClick:E},{default:s(()=>e[4]||(e[4]=[S("添加")])),_:1})]),_:1}),n(p,{columns:A,"data-source":v.value,pagination:r.value,loading:f.value,"row-key":"id",onChange:O,scroll:{x:800,y:500}},{emptyText:s(()=>[f.value?z("",!0):(C(),$(b,{key:0,description:"暂无数据"},{description:s(()=>[Q("span",null,j(v.value.length===0?"当前没有黑名单用户":"没有匹配的数据"),1)]),_:1}))]),bodyCell:s(({column:u,record:V})=>[u.key==="action"?(C(),$(o,{key:0,size:"small",danger:"",onClick:se=>M(V)},{default:s(()=>e[5]||(e[5]=[S("移除")])),_:2},1032,["onClick"])):z("",!0)]),_:1},8,["data-source","pagination","loading"]),n(T,{open:g.value,"onUpdate:open":e[3]||(e[3]=u=>g.value=u),title:"添加黑名单用户",onOk:L,"confirm-loading":k.value},{default:s(()=>[n(N,{"label-col":{span:4},"wrapper-col":{span:20}},{default:s(()=>[n(I,{label:"用户ID",required:""},{default:s(()=>[n(B,{value:c.value,"onUpdate:value":e[1]||(e[1]=u=>c.value=u),placeholder:"请输入用户ID"},null,8,["value"])]),_:1}),n(I,{label:"原因",required:""},{default:s(()=>[n(B,{value:m.value,"onUpdate:value":e[2]||(e[2]=u=>m.value=u),placeholder:"请输入添加原因"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["open","confirm-loading"])])}}},pe=R(oe,[["__scopeId","data-v-8225dbe6"]]);export{pe as default};
